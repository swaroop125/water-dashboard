<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Water Quality Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/justgage@1.3.5/justgage.min.js"></script>
  <style>
    body {
      font-family: Arial;
      text-align: center;
      background: #f0f8ff;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #007acc;
      margin-bottom: 30px;
    }
    .gauge-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }
    .gauge-box {
      background: white;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      width: 250px;
    }
    .gauge-label {
      margin-top: 10px;
      font-weight: bold;
      font-size: 1.1em;
      color: #004080;
    }
    #alerts {
      margin-top: 30px;
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Water Quality Dashboard</h1>
  <div class="gauge-container">
    <div class="gauge-box">
      <div id="temp-gauge" style="height:160px;"></div>
      <div class="gauge-label">Temperature (¬∞C)</div>
    </div>
    <div class="gauge-box">
      <div id="ph-gauge" style="height:160px;"></div>
      <div class="gauge-label">pH Level</div>
    </div>
    <div class="gauge-box">
      <div id="tds-gauge" style="height:160px;"></div>
      <div class="gauge-label">TDS (ppm)</div>
    </div>
  </div>

  <div id="alerts"></div>

  <script>
    const tempGauge = new JustGage({
      id: "temp-gauge",
      min: 0,
      max: 100,
      value: 0,
      levelColors: ["#00ccff", "#ffff00", "#ff3300"]
    });

    const phGauge = new JustGage({
      id: "ph-gauge",
      min: 0,
      max: 14,
      value: 7,
      levelColors: ["#ff0000", "#00cc00", "#0000ff"]
    });

    const tdsGauge = new JustGage({
      id: "tds-gauge",
      min: 0,
      max: 1000,
      value: 0,
      levelColors: ["#00cc00", "#ffcc00", "#ff0000"]
    });

    function fetchData() {
      fetch('/data')
        .then(response => response.text())
        .then(text => {
          const parts = text.split('&');
          const data = {};
          parts.forEach(p => {
            const [k, v] = p.split('=');
            data[k] = parseFloat(v);
          });

          tempGauge.refresh(data.temp || 0);
          phGauge.refresh(data.ph || 0);
          tdsGauge.refresh(data.tds || 0);

          let alerts = "";
          if (data.temp > 40) alerts += "üî• Temperature too high!<br>";
          if (data.ph > 8.5) alerts += "‚ö†Ô∏è pH too high!<br>";
          if (data.ph < 5.9) alerts += "‚ö†Ô∏è pH too low!<br>";
          if (data.tds > 550) alerts += "üíß TDS too high!<br>";
          document.getElementById("alerts").innerHTML = alerts || "‚úÖ All parameters normal.";
        })
        .catch(err => {
          document.getElementById("alerts").innerHTML = "‚ùå Error fetching data.";
          console.error(err);
        });
    }

    fetchData();
    setInterval(fetchData, 5000);
  </script>
</body>
</html>
